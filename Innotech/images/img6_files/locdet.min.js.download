function initMap(){resolveUserZip();window.addEventListener("zipCookieChange",function(b){setRegionCodeCookie()});initLocationMap()}function getUserZipFromAkamai(){var b=$.Deferred(),a=null;$.ajax({type:"HEAD",url:window.location}).done(function(c,d,e){c=e.getResponseHeader("X-Akamai-Edgescape");null!==c&&(c=c.match(/zip=(\d{5})/),null!==c&&(a=c[0]));b.resolve(a)}).fail(function(){console.log("Error getting http headers");b.resolve(a)});return b.promise()}
function getUserZipFromBrowser(){var b=$.Deferred(),a=null,c=new google.maps.Geocoder;"geolocation"in navigator&&null!==c&&"undefined"!==typeof c?navigator.geolocation.getCurrentPosition(function(d){var e={lat:d.coords.latitude,lng:d.coords.longitude};d=new CustomEvent("locationRetrieved",{detail:d});window.dispatchEvent(d);c.geocode({location:e},function(c,d){if(d===google.maps.GeocoderStatus.OK)for(c=c[0].address_components,d=0;d<c.length;d++){var e=c[d];"postal_code"===e.types[0]&&(a=e.short_name)}else console.log("Unable to geocode: "+
d);b.resolve(a)})},function(c){console.log("error geolocating user: ",c);c=new CustomEvent("locationRetrieved",{detail:null});window.dispatchEvent(c);b.resolve(a)},{timeout:6E4}):b.resolve(a);return b.promise()}
function resolveUserZip(){var b=$.Deferred();$.when(getProfileZip()).done(function(a){null!==a?(b.resolve(a),setZipCookies(a,!1)):$.when(getUserZipFromBrowser()).done(function(a){null===a?$.when(getUserZipFromAkamai()).done(function(a){null!==a?(b.resolve(a),setZipCookies(a,!0)):(b.resolve("20006"),setZipCookies("20006",!0))}):(b.resolve(a),setZipCookies(a,!0))})})}
function gm_authFailure(){var b=$.Deferred();$.when(getUserZipFromAkamai()).done(function(a){null!==a?(b.resolve(a),setZipCookies(a,!0)):(b.resolve("20006"),setZipCookies("20006",!0))})}function setZipCookies(b,a){null!=b&&(Cookies.set("LOCATION_ZIP",b),b=new CustomEvent("zipCookieChange",{detail:b}),window.dispatchEvent(b));Cookies.set("LOCATION_ZIP_RECHECK",a)}
function setRegionCodeCookie(){var b=Cookies.get("LOCATION_ZIP");$.ajax({url:$("#api-urls").data("api-lookup")+"/region-mappings/"+b+"?type\x3dRCO",contentType:"application/json;charset\x3dUTF-8",dataType:"json",type:"GET"}).done(function(a){a.length&&(a=a[0].regionCode,Cookies.set("REGION_CODE",a),"undefined"!==typeof ContextHub&&ContextHub.getStore("regioncode").setRegionCode(a),a=new CustomEvent("regionCookieChange",{detail:a}),window.dispatchEvent(a))}).fail(function(){})}
function getProfileZip(){var b=$.Deferred(),a=null;localStorage.RCO_AUTH?$.ajax({url:$("#api-urls").data("api-account")+"/account",contentType:"application/json;charset\x3dUTF-8",dataType:"json",type:"GET",xhrFields:{withCredentials:!0}}).done(function(c){c.personalInfo&&c.personalInfo.postalCode&&(a=c.personalInfo.postalCode);b.resolve(a)}).fail(function(){b.resolve(a)}):b.resolve(a);return b.promise()};